# Traefik dynamic configuration for independent deployment
# Based on devcontainers-deploy-docker principles

http:
  routers:
    traefik-dashboard:
      rule: "Host(`{{ ansible_default_ipv4.address }}`) && (PathPrefix(`/api`) || PathPrefix(`/dashboard`))"
      service: api@internal
      middlewares:
        - traefik-auth
      tls: {}

  middlewares:
    traefik-auth:
      basicAuth:
        users:
          - "admin:{{ traefik_admin_password }}"
    
    # Security headers
    security-headers:
      headers:
        frameDeny: true
        sslRedirect: true
        browserXssFilter: true
        contentTypeNosniff: true
        forceSTSHeader: true
        stsIncludeSubdomains: true
        stsPreload: true
        stsSeconds: {{ traefik_hsts_seconds }}

    # Rate limiting (optional)
    rate-limit:
      rateLimit:
        burst: {{ traefik_rate_limit_burst }}
        average: {{ traefik_rate_limit_average }}

tls:
  options:
    default:
      minVersion: {{ traefik_tls_min_version }}
      cipherSuites: {{ traefik_tls_cipher_suites }}
